# はじめに

chobiit では、バックエンドとして API Gateway + Lambda + DynamoDB という構成、

フロントエンドは HTML + Javascript のクライアントサイドレンダリングな”普通”の構成になっています。また、フロントエンドの HTML, JS は CloudFront 経由で S3 から配信しています。


機能改修を進める中で、リリース直後にフロントエンドの js が古いコードのまま動くと不具合を発生させる可能性があります。
よって、可能であれば後方互換性を保った機能改修をすることが安全であると考えます。

# 後方互換性とは

https://www.sophia-it.com/content/%E5%BE%8C%E6%96%B9%E4%BA%92%E6%8F%9B%E6%80%A7

# なぜ後方互換性を考慮する必要があるのか

バックエンドは AWS Lambda で即時にデプロイしたコードが反映されます。

一方で、フロントエンドについては、ブラウザにダウンロードされた HTML, JS が動いているので、リリース前の古いファイルが動いている可能性があります。

従って、もし古いフロントエンドのファイルでは動かないような改修をバックエンドに対して行ってしまうと、不具合を発生させてしまう可能性があります。

# どうやってリリースを進めていけば良いか

改修の具合によるので一般論をここで述べることは困難だと考えます。それぞれの改修やリリースを具体的にみていき、互換性が保たれているかをチェックする必要があります。

## リリースの具体例

- バックエンドを互換性を保った改修をしてリリースする　→　ある程度時間が空いたのち、古いフロントを考慮したコードを削除して、バックエンドをもう一度リリースする。


# 注意

ここでの後方互換性は、 **永続的に保障すべきものではない** ことに注意してください。
上述の通り、単にキャッシュヒットしてしまった場合の一時的な不具合を避けるためのものであります。

従って、ごく短い期間（しかしコンピュータには長い時間）にしか発生し得ないようなケースを想定しています（仮に chobiit が API を公開していれば話は別ですが、一応クローズドな API のつもりで使っているので）。

ゆえに、互換性を無理に保ち続けることはやめてください。
速やかかつ頻繁にリリースを行い、常にシステムをクリーンで健全に保つ努力がなされることを期待します。


